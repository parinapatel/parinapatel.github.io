{"componentChunkName":"component---src-templates-post-js","path":"/pensieve/Github-Pages","result":{"data":{"markdownRemark":{"html":"<h2>Introduction</h2>\n<p>We will be talking about how to set up website using GitHub Action and GitHub pages. This is really easy way to set up website free.</p>\n<h2>PreReq</h2>\n<p>I will be assuming that you have a GitHub account and have small webapp running locally , we will be covering on how\nto start working on webapp in later tutorial. We are here using gatsbyJS based webapp to be published on <a href=\"https://pages.github.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github\nPages</a>.</p>\n<h2>Github Actions</h2>\n<p>GitHub Actions makes it easy to automate all your software workflows, and support CI/CD pipeline thus allowing us to\nbuild our private repo on code changes and deploy them automatically. Assuming we have a node js project , we can\nstart by creating a directory <code class=\"language-text\">.github</code> and subdirectory <code class=\"language-text\">workflow</code>. This is where we will be storing YAML files.\nhere we are working with single workflow, but it can be multiple workflows depending on use case.\nYour directory structure may looklike below:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">my-app/\n    |- .github\n      |- workflow\n         |- nodejs.yaml\n    |- package.json\n    |- lib\n      |- code.js\n    |- index.js</code></pre></div>\n<p>We can use following YAML as templete:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node</span>\n<span class=\"token comment\"># For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions</span>\n\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Node.js CI\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\">#  Underline system to use</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token comment\">#  If we want to support multiple underline node versions</span>\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>10.x<span class=\"token punctuation\">]</span>\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Use Node.js $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.node<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.node<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install</code></pre></div>\n<p>This tells it to install the environment and sets up the packages. Now We are using gatsbyJS to deploy on GGithub pages but there is alternative suggested below to use which allows to us to deploy on GitHub pages.</p>\n<h2>Deploy on GitHub Pages using gatsby-cli</h2>\n<p>First we need to install a package called : <code class=\"language-text\">gh-page</code> , it makes our job way easier as it builds webapp and then also deploy on github for you. Create a run script fordeploy</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby build --prefix-paths &amp;&amp; gh-pages -d public\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Add script to deploy to GitHub Pages via CI</h3>\n<p>Update the Gatsby project’s package.json to also include a deployment run script which invokes gh-pages with two important command-line arguments:</p>\n<ol>\n<li><code class=\"language-text\">-d public</code> - specifies the directory in which the built files exist and will be pushed as a source to GitHub Pages</li>\n<li><code class=\"language-text\">-r URL</code> - the GitHub repository URL, including the use of the secret GitHub token (as a secret environment variable) to be able to push changes to the gh-pages branch, in the form of <code class=\"language-text\">https://$GH_TOKEN@github.com/&lt;github username&gt;/&lt;github repository name&gt;.git</code>\nHere’s an example</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby build --prefix-paths &amp;&amp; gh-pages -d public -r https://$GH_TOKEN@github.com/lirantal/dockly.git\"</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Update github actions file to automate.</h2>\n<p>add following step after <code class=\"language-text\">npm install</code> step. Also note the if condition which make sure to deploy only on the branch if its master.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run deploy\n      <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> github.ref == 'refs/heads/master'\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">GH_TOKEN</span><span class=\"token punctuation\">:</span> &lt;YOUR_TOKEN<span class=\"token punctuation\">></span></code></pre></div>\n<h3>How to generate token.</h3>\n<p>Follow instruction here : <a href=\"https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line</a>\nYou will need following permission:</p>\n<ul>\n<li>repo</li>\n</ul>\n<p>Let me know how it turns out to be.</p>","frontmatter":{"title":"Publish on Github Pages","description":"Publish on Github Pages","date":"2020-04-10","slug":"/pensieve/Github-Pages","tags":["gatsby","nodejs","github"]}}},"pageContext":{}}}